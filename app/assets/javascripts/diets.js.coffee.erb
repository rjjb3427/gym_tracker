# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://jashkenas.github.com/coffee-script/

$(document).ready ->
  save_path = $('#new_food_line_item').attr('action')

  $("form#new_food_line_item").submit (event) ->
    event.preventDefault()
    url = $(this).attr('action')
    method = $(this).attr('method')
    food_id = $('#food_line_item_food_id').val()
    ammount = $('#food_line_item_ammount').val()

    if method == 'put'
      $.ajax
        type: method
        url: url
        data: { food_line_item: { food_id: food_id,ammount: ammount}}
        dataType: 'json'
        success: (json) ->
            line_item = $('#line_item_'+json.id)
            $('.line_item_ammount', $(line_item)).text(json.ammount)
            $('.line_item_name', $(line_item)).text(json.food.name)

            $('#food_line_item_food_id').val(0)
            $('#food_line_item_ammount').val("")
            $('#new_food_line_item').attr('method', 'post')
            $('#new_food_line_item').attr('action', save_path)
            return
    else
      $.ajax
        type: method
        url: url
        data: { food_line_item: { food_id: food_id,ammount: ammount}}
        dataType: 'html'
        success: (html) ->
          $('#line_items tbody').append(html)
          return

    return

  $('.update_line_item').click (event) ->
    line_item = $(this).parent().parent()
    food = $('.food_id', $(line_item)).val()
    ammount = $('.line_item_ammount', $(line_item)).text()

    $('#new_food_line_item').attr('method', 'put')
    $('#new_food_line_item').attr('action', $(this).attr('href'))

    $('#food_line_item_food_id').val(food)
    $('#food_line_item_ammount').val(ammount)
    return false

  return    